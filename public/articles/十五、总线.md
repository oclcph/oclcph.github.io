---
title: 总线
abstract: 计组第十五章笔记
category: 计算机组成原理
---

# 十五、总线

**类型：**

1. 芯片内部总线，连接芯片内部各个部分，如CPU中连接寄存器、ALU等
2. 系统总线，连接CPU、存储器、IO控制器等
3. 通信总线，连接主机和I/O设备或连接不同计算机系统

**总线结构：**

1. 数据线：在系统组件之间传输数据
2. 地址线：在数据线和地址I/O端口上指定数据来源和去向，寻址空间大小
3. 控制线：控制对数据线和地址线的存取和使用，时钟、总线请求/允许、中断请求/响应

> 总线可以被多个设备监听，但同一时刻只能由一个设备发送数据

## 设计要素

### 用途

**专用**总线，始终只负责一项功能，或始终分配给特定件，可以减少总线冲突

**复用**总线，将同一线路用于多种用途，可以节省空间和成本，但电路复杂

### 仲裁

**总线仲裁**：当多个设备需要和总线通信时，通过某种策略选择一个设备

> 优先级越高，设备越优先；优先级最低的设备不能一直被延迟

**集中式：**由仲裁器或总线控制器负责分配总线使用权

**分布式：**每个设备都包含访问控制逻辑

1. 链式查询：所有设备串行连接，并将允许信号从优先级最高的设备下发到优先级最低的设备![image-20241208213804458](C:\Users\ocl\AppData\Roaming\Typora\typora-user-images\image-20241208213804458.png)
2. 计数器查询，把总线允许线替换为设备ID线。如果总线空闲，总线仲裁器通过设备ID线发送计数；如果发送请求的设备ID等于裁决器当前ID，则停止计数并设置为繁忙
3. 独立请求，每个设备都有自己的总线请求线和允许线，由仲裁器调度。LRU、FIFO等
4. 自举式，固定优先级，每个设备都有总线请求线，自行判断是否在请求总线的设备中优先级最高
5. 冲突检测，检查总线是否繁忙。如果同时有多个设备发现总线空闲，可能会产生冲突。如果发生冲突，所有使用总线的设备停止数据传输，并分别在随机间隔时间后再次请求

### 时序

确定每个总线事务的开始和结束时间

1. 同步时序，事件发生由时钟决定
2. 异步时序，一个事件的发生取决于前一个事件的发生
3. 半同步，同步、异步结合
4. 分离事务，设备准备数据期间释放总线，把一个事件分离为多个过程

### 总线带宽和数据传输速率

总线带宽：总线的最大数据传输速率

数据传输速率：考虑地址传输、握手等因素

总线宽度：组成总线的线数

<img src="C:\Users\ocl\AppData\Roaming\Typora\typora-user-images\image-20241213212153025.png" alt="image-20241213212153025" style="zoom:50%;" /><img src="C:\Users\ocl\AppData\Roaming\Typora\typora-user-images\image-20241213212204972.png" alt="image-20241213212204972" style="zoom:50%;" />

### 总线层级结构

**单总线结构：**CPU、存储器、IO模块都连接到同一条系统总线

**双总线结构：**

1. 在CPU和存储器中间加一条存储器总线

2. 将系统总线分为存储器总线、IO总线和IOP，降低IO负担

   ![image-20241208224218316](C:\Users\ocl\AppData\Roaming\Typora\typora-user-images\image-20241208224218316.png)

**多总线结构：**

1. 增加本地总线连接CPU和cache

2. 将系统总线分为存储器总线、IO总线、DMA总线

   ![image-20241208224225850](C:\Users\ocl\AppData\Roaming\Typora\typora-user-images\image-20241208224225850.png)

3. 增加告诉IO总线，连接高速设备
