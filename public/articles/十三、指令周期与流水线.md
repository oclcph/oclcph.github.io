---
title: 指令周期与流水线
abstract: 计组第十三章笔记
category: 计算机组成原理
---

# 指令周期与流水线

## 指令周期

**指令周期：**处理单个指令的过程，取指、执行

**间址周期：**指令执行时需要存储器访问，间接寻址需要额外的存储器访问，把间接寻址堪称额外的指令子周期

![image-20241202203233510](C:\Users\ocl\AppData\Roaming\Typora\typora-user-images\image-20241202203233510.png)

**取指周期：**

1. PC通过地址总线、控制器通过控制总线找到存储器地址
2. 存储器从数据总线中取出指令

**间址周期：**

1. MBR与MAR进行间接寻址，通过地址总线，控制器通过控制总线找到存储器
2. 存储器在数据总线中找到数据返回给MBR

**中断周期：**

1. 控制器通过PC和MAR分别控制数据总线和地址总线，进而控制存储器，发出中断

## 指令流水线

一条指令的处理过程分为若干个阶段，每个阶段都由响应的功能部件完成

> 例如分成两段，取指令+执行
>
> 问题在于，执行时间一般长于取指时间，同时还有主存访问冲突、条件分支指令使得待取的下一条指令地址未知

### 六阶段方法

取指令、译码指令、计算操作数地址、取操作数、执行指令、写操作数

> 不是所有指令都包含6个阶段，如LOAD不需要WO（写操作数）

### ==流水线性能==

$t_i$：流水线第i段的电路延迟时间

$t_m$：最大段延迟，通过耗时最长段的延迟

$k$：指令流水线段数

$d$：锁存延时，数据和信号从上一段送到下一段所需的段间锁存接收时间

**周期时间**：$t=max[t_i]+d=t_m+d$

令$T_{k,n}$为k阶段流水线执行所有n条指令所需的时间

则**加速比：**$S_k=\frac{T_{1,n}}{T_{k,n}}=\frac{nkt}{[k+(n-1)t]}=\frac{nk}{k+n-1}=\frac{n}{1+\frac{n-1}{k}}$

> 并非流水线阶段数越多程序执行越快，将数据从一个缓冲区移动到另一个缓冲区、执行准备和传递功能需要开销

## 冒险

指令流水线受到阻塞/停顿，导致后续指令无法执行

### 结构冒险

已进入流水线的不同指令在同一时刻访问相同的硬件资源，比如同时访问内存，可以使用多个硬件资源，或者分时使用

### 数据冒险

未生成指令所需要的数据

![image-20241202205311057](C:\Users\ocl\AppData\Roaming\Typora\typora-user-images\image-20241202205311057.png)

**解决方案：**

1. 插入nop指令，不执行指令

2. 插入bubble，虚拟暂停程序运行

3. 转发/旁路

   ![image-20241202205523251](C:\Users\ocl\AppData\Roaming\Typora\typora-user-images\image-20241202205523251.png)

4. 交换指令顺序

### 控制冒险

指令执行的顺序被更改

**解决方案：**

1. 取多条指令，例如多个指令流或预取分支目标或者维护一个循环缓冲器，含有最近取来的指令
2. 分支预测，静态预测/动态预测
